void send_sensor_data(EthernetClient *client, int num_sample) {
  unsigned int address; 
  float temp_c;
  float temp_f;
  float volts;

  read_sample(num_sample, &address, &temp_c, &temp_f, &volts);

  client->println("<br/>");
  client->print("Node Address: ");
  client->print(address, HEX);
  client->print(".");
}

void listener() {
  EthernetClient client = server.available();
  if (client) {
    Serial.println("Got a connection!");
    boolean currentLineIsBlank = true;
    while (client.connected()) {
      if (client.available()) {
        char c = client.read();
        if (c == '\n' && currentLineIsBlank) {
          client.println("HTTP/1.1 200 OK");
          client.println("Content-Type: text/html");
          client.println();
          
          client.println("Welcome to the Arduino Data Aggregate Node");
          client.println("<br/>");
 
          byte num_samples = EEPROM.read(0);
          for (int i = 0; i < num_samples; i++) {
            send_sensor_data(&client, i);
          }
          if (num_samples == 0) {
            client.print("No samples to display.");
            client.println("<br/>");
          }
          break;
        }
        if (c == '\n') {
          currentLineIsBlank = true;
        } else if (c != '\r') {
          currentLineIsBlank = false;
        }
      }
    }
    delay(1);
    client.stop();
  }
}
      
